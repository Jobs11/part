<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부품 재고 관리 시스템</title>
    <link rel="stylesheet" href="css/excel-style.css">
    <style>
        .help-section {
            display: none;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #fffbf0;
            border-left: 3px solid #ffa500;
            color: #444;
            font-size: 12px;
            line-height: 1.6;
        }

        .help-section.show {
            display: block;
        }

        .help-toggle {
            margin-left: 10px;
            padding: 3px 10px;
            font-size: 11px;
            background-color: #ffa500;
            color: white;
            border: 1px solid #e69500;
            cursor: pointer;
            border-radius: 3px;
        }

        .help-toggle:hover {
            background-color: #e69500;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-header h2 {
            margin: 0;
            flex: 1;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>부품 재고 관리 시스템</h1>

        <!-- 부품 등록 -->
        <div class="section">
            <div class="section-header">
                <h2>부품 등록 (부품 번호 동일시 수량만 업데이트)</h2>
                <button class="help-toggle" onclick="toggleHelp('help1')">📖 사용방법</button>
            </div>
            <div id="help1" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 부품번호, 부품명, 수량을 입력하여 부품을 등록합니다.<br>
                • 동일한 부품번호가 이미 존재하는 경우, 기존 수량에 입력한 수량이 더해집니다.<br>
                • 부품번호는 "P-0001" 형식으로 입력하며, 자동으로 "P-"가 입력되어 있습니다.<br>
                • 단위와 설명은 선택 사항입니다.
            </div>
            <form id="insertForm" class="form-inline">
                <input type="text" id="insertPartNumber" placeholder="예: P-0001" value="P-" required>
                <input type="text" id="insertPartName" placeholder="부품명" required>
                <input type="number" id="insertQuantity" placeholder="수량" required min="0">
                <input type="text" id="insertUnit" placeholder="단위">
                <input type="text" id="insertDescription" placeholder="설명">
                <button type="submit" class="btn">등록</button>
            </form>
        </div>

        <!-- 부품 일괄 등록 -->
        <div class="section">
            <div class="section-header">
                <h2>부품 일괄 등록</h2>
                <button class="help-toggle" onclick="toggleHelp('help2')">📖 사용방법</button>
            </div>
            <div id="help2" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 여러 개의 부품을 한 번에 등록할 수 있습니다.<br>
                • 기본 5개 행이 제공되며, 필요시 "입력 행 추가" 버튼으로 행을 추가할 수 있습니다.<br>
                • 부품번호, 부품명, 수량이 모두 입력된 행만 등록됩니다.<br>
                • 동일한 부품번호가 있는 경우 수량이 자동으로 합산됩니다.
            </div>
            <div style="margin-bottom: 10px;">
                <button onclick="toggleBulkInsert()" class="btn">일괄 등록 열기/닫기</button>
                <button onclick="addBulkRow()" class="btn" id="addRowBtn" style="display: none;">입력 행 추가 +</button>
                <button onclick="removeBulkRow()" class="btn btn-gray" id="removeRowBtn" style="display: none;">마지막 행 삭제
                    -</button>
            </div>
            <div id="bulkInsertArea" style="display: none;">
                <form id="bulkInsertForm">
                    <div class="table-wrapper" style="max-height: 450px;">
                        <table id="bulkInsertTable">
                            <thead>
                                <tr>
                                    <th style="width: 5%;">No</th>
                                    <th style="width: 20%;">부품번호</th>
                                    <th style="width: 25%;">부품명</th>
                                    <th style="width: 13%;">수량</th>
                                    <th style="width: 12%;">단위</th>
                                    <th style="width: 25%;">설명</th>
                                </tr>
                            </thead>
                            <tbody id="bulkInsertBody">
                                <!-- 동적으로 추가됨 -->
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 10px;">
                        <button type="submit" class="btn">일괄 등록 실행</button>
                        <button type="button" onclick="clearBulkForm()" class="btn btn-gray">전체 초기화</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 부품 전체 리스트 -->
        <div class="section">
            <div class="section-header">
                <h2>부품 전체 리스트 (셀 더블클릭으로 수정 가능)</h2>
                <button class="help-toggle" onclick="toggleHelp('help3')">📖 사용방법</button>
            </div>
            <div id="help3" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 등록된 모든 부품을 조회할 수 있습니다.<br>
                • 부품번호 또는 부품명으로 검색이 가능합니다.<br>
                • 컬럼 헤더를 클릭하면 해당 항목 기준으로 오름차순/내림차순 정렬됩니다.<br>
                • 편집 가능한 셀을 더블클릭하면 직접 수정할 수 있습니다. (Enter로 저장, ESC로 취소)<br>
                • 부품의 행을 클릭하면 하단 "부품 사용처 등록"에 자동으로 선택됩니다.
            </div>
            <div class="form-inline" style="margin-bottom: 10px;">
                <input type="text" id="partsSearchInput" placeholder="부품번호 또는 부품명으로 검색" style="min-width: 250px;">
                <button onclick="searchParts()" class="btn">검색</button>
                <button onclick="loadAllParts()" class="btn">전체 보기</button>
            </div>
            <button onclick="loadAllParts()" class="btn">새로고침</button>
            <div class="table-wrapper">
                <table id="partsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('part_number')" style="cursor: pointer;">부품번호 ▲▼</th>
                            <th onclick="sortTable('part_name')" style="cursor: pointer;">부품명 ▲▼</th>
                            <th onclick="sortTable('quantity')" style="cursor: pointer;">수량 ▲▼</th>
                            <th>단위</th>
                            <th>설명</th>
                            <th>등록일</th>
                        </tr>
                    </thead>
                    <tbody id="partsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center;">로딩 중...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 재고 부족 부품 -->
        <div class="section">
            <div class="section-header">
                <h2>재고 부족 부품</h2>
                <button class="help-toggle" onclick="toggleHelp('help4')">📖 사용방법</button>
            </div>
            <div id="help4" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 기준 수량 이하인 부품을 조회합니다.<br>
                • 기준 수량을 입력하고 "검색" 버튼을 클릭하세요. (기본값: 10개)<br>
                • 수량이 적은 순서대로 정렬되어 표시됩니다.<br>
                • 재고 부족 부품은 빨간색 배경으로 강조 표시됩니다.
            </div>
            <div class="form-inline" style="margin-bottom: 10px;">
                <input type="number" id="lowStockThreshold" placeholder="기준 수량" value="10" min="1"
                    style="max-width: 120px;">
                <button onclick="loadLowStockParts()" class="btn">검색</button>
            </div>
            <div class="table-wrapper">
                <table id="lowStockTable">
                    <thead>
                        <tr>
                            <th>부품번호</th>
                            <th>부품명</th>
                            <th>수량</th>
                            <th>단위</th>
                            <th>설명</th>
                        </tr>
                    </thead>
                    <tbody id="lowStockTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center;">로딩 중...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 부품 사용처 등록 -->
        <div class="section">
            <div class="section-header">
                <h2>부품 사용처 등록</h2>
                <button class="help-toggle" onclick="toggleHelp('help5')">📖 사용방법</button>
            </div>
            <div id="help5" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 부품을 사용한 내역을 등록합니다.<br>
                • 위 "부품 전체 리스트"에서 사용할 부품의 행을 클릭하면 부품번호와 부품명이 자동으로 입력됩니다.<br>
                • 사용 수량, 사용처, 사용일을 입력하고 등록하면 재고에서 자동으로 차감됩니다.<br>
                • 비고는 선택 사항입니다.
            </div>
            <form id="usageForm" class="form-inline">
                <input type="text" id="usagePartNumber" placeholder="부품번호 (리스트 클릭)" readonly>
                <input type="text" id="usagePartName" placeholder="부품명" readonly>
                <input type="number" id="quantityUsed" placeholder="사용 수량" required min="1">
                <input type="text" id="usageLocation" placeholder="사용처" required>
                <input type="date" id="usedDate" required>
                <input type="text" id="usageNote" placeholder="비고">
                <button type="submit" class="btn">등록</button>
                <button type="button" onclick="clearUsageForm()" class="btn btn-gray">초기화</button>
            </form>
        </div>

        <!-- 부품 사용 내역 -->
        <div class="section">
            <div class="section-header">
                <h2>부품 사용 내역</h2>
                <button class="help-toggle" onclick="toggleHelp('help6')">📖 사용방법</button>
            </div>
            <div id="help6" class="help-section">
                💡 <strong>사용 방법:</strong><br>
                • 등록된 모든 부품 사용 내역을 조회할 수 있습니다.<br>
                • 부품번호 또는 사용처로 검색이 가능합니다.<br>
                • 컬럼 헤더를 클릭하면 해당 항목 기준으로 오름차순/내림차순 정렬됩니다.<br>
                • 편집 가능한 셀을 더블클릭하면 직접 수정할 수 있습니다. (수정 시 재고가 자동 반영됩니다)
            </div>
            <div class="form-inline" style="margin-bottom: 10px;">
                <input type="text" id="usagePartFilter" placeholder="부품번호로 검색">
                <button onclick="filterUsageByPart()" class="btn">부품번호 검색</button>
                <input type="text" id="usageLocationFilter" placeholder="사용처로 검색">
                <button onclick="filterUsageByLocation()" class="btn">사용처 검색</button>
                <button onclick="loadAllUsage()" class="btn">전체 보기</button>
            </div>
            <div class="table-wrapper">
                <table id="usageTable">
                    <thead>
                        <tr>
                            <th onclick="sortUsageTable('used_date')" style="cursor:pointer;">사용일 ▲▼</th>
                            <th onclick="sortUsageTable('part_number')" style="cursor:pointer;">부품번호 ▲▼</th>
                            <th onclick="sortUsageTable('part_name')" style="cursor:pointer;">부품명 ▲▼</th>
                            <th onclick="sortUsageTable('quantity_used')" style="cursor:pointer;">사용 수량 ▲▼</th>
                            <th>단위</th>
                            <th onclick="sortUsageTable('usage_location')" style="cursor:pointer;">사용처 ▲▼</th>
                            <th>비고</th>
                            <th>기록일</th>
                        </tr>
                    </thead>
                    <tbody id="usageTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center;">로딩 중...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 메시지 표시 -->
        <div id="message" class="message"></div>
    </div>

    <script src="js/main.js?v=7"></script>
    <script>
        // 사용방법 토글 함수
        function toggleHelp(id) {
            const helpSection = document.getElementById(id);
            helpSection.classList.toggle('show');
        }
    </script>
</body>

</html>
